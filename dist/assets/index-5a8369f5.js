const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sample-5bcd804c.js","assets/react-bc301c2f.js","assets/dexie-d9f8aec0.js","assets/vendor-7461c230.js","assets/backup-33ad317f.js"])))=>i.map(i=>d[i]);
import{r as c,j as e,R as It,a as At}from"./react-bc301c2f.js";import{D as Ue}from"./dexie-d9f8aec0.js";import"./vendor-7461c230.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const h of r)if(h.type==="childList")for(const o of h.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function a(r){const h={};return r.integrity&&(h.integrity=r.integrity),r.referrerPolicy&&(h.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?h.credentials="include":r.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function l(r){if(r.ep)return;r.ep=!0;const h=a(r);fetch(r.href,h)}})();const Ct="modulepreload",Dt=function(t){return"/"+t},ot={},$=function(s,a,l){let r=Promise.resolve();if(a&&a.length>0){let k=function(S){return Promise.all(S.map(C=>Promise.resolve(C).then(i=>({status:"fulfilled",value:i}),i=>({status:"rejected",reason:i}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),g=o?.nonce||o?.getAttribute("nonce");r=k(a.map(S=>{if(S=Dt(S),S in ot)return;ot[S]=!0;const C=S.endsWith(".css"),i=C?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${S}"]${i}`))return;const p=document.createElement("link");if(p.rel=C?"stylesheet":Ct,C||(p.as="script"),p.crossOrigin="",p.href=S,g&&p.setAttribute("nonce",g),document.head.appendChild(p),C)return new Promise((v,j)=>{p.addEventListener("load",v),p.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${S}`)))})}))}function h(o){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=o,window.dispatchEvent(g),!g.defaultPrevented)throw o}return r.then(o=>{for(const g of o||[])g.status==="rejected"&&h(g.reason);return s().catch(h)})};function Rt(t){const s=t.replace(/[\u200B-\u200D\uFEFF]/g,"").trim();return s?s.split(/[\s.,;:!?(){}\[\]"'“”‘’—–\-_/\\|]+/g).filter(Boolean).length:0}function Pt(t){return t.replace(/[\s\p{P}\p{S}]/gu,"").trim().length}function Te(t,s){return s?Pt(t):Rt(t)}function Et(t,s){const a=t.replace(/[\u200B-\u200D\uFEFF]/g,"").trim();if(!a)return[];if(s)return Array.from(new Set(a.replace(/[\s\p{P}\p{S}]/gu,"").split("").filter(Boolean)));const l=a.split(/[\s.,;:!?(){}\[\]"'“”‘’—–\-_/\\|]+/g).map(r=>r.trim()).filter(Boolean).map(r=>r.toLowerCase());return Array.from(new Set(l))}class _t extends Ue{datasets;decks;imports;sentences;progress;pathProgress;srs;seenWords;stats;constructor(){super("sentencepaths_db"),this.version(1).stores({datasets:"id, name, languageTag, createdAt",sentences:"id, datasetId",progress:"datasetId"}),this.version(2).stores({datasets:"id, name, languageTag, createdAt",decks:"id, datasetId, createdAt, [datasetId+createdAt]",imports:"id, datasetId, deckId, createdAt, [datasetId+deckId+createdAt]",sentences:"id, datasetId, deckId, order, importId, [datasetId+deckId], [datasetId+deckId+order], [datasetId+deckId+importId]",progress:"datasetId",pathProgress:"&[datasetId+deckId], datasetId, deckId, updatedAt",srs:"&[datasetId+deckId+sentenceId], datasetId, deckId, dueAt, [datasetId+deckId+dueAt]"}).upgrade(async s=>{const a=await s.table("datasets").toArray();for(const l of a){const r=`deck_${l.id}`,h=s.table("decks");await h.get(r).catch(()=>{})||await h.add({id:r,datasetId:l.id,name:"Main",createdAt:l.createdAt??Date.now()});const g=s.table("sentences"),k=await g.where("datasetId").equals(l.id).toArray();k.sort((p,v)=>String(p.id).localeCompare(String(v.id)));for(let p=0;p<k.length;p++)k[p].deckId=r,k[p].order=p,k[p].importId="legacy";k.length&&await g.bulkPut(k);const S=await s.table("progress").get(l.id),C=s.table("pathProgress");if(!await C.get([l.id,r]).catch(()=>{})){const p=S?.currentIndex??0;await C.put({datasetId:l.id,deckId:r,mode:"linear",linearOrder:p,srsNewOrder:p,lifetimeReps:S?.lifetimeReps??0,lifetimeTokens:S?.lifetimeTokens??0,updatedAt:Date.now()})}}}),this.version(3).stores({datasets:"id, name, languageTag, createdAt",decks:"id, datasetId, createdAt, [datasetId+createdAt]",imports:"id, datasetId, deckId, createdAt, [datasetId+deckId+createdAt]",sentences:"id, datasetId, deckId, order, importId, [datasetId+deckId], [datasetId+deckId+order], [datasetId+deckId+importId]",progress:"datasetId",pathProgress:"&[datasetId+deckId], datasetId, deckId, updatedAt",srs:"&[datasetId+deckId+sentenceId], datasetId, deckId, dueAt, [datasetId+deckId+dueAt]",seenWords:"&[datasetId+token], datasetId, firstSeenAt",stats:"datasetId, updatedAt"}).upgrade(async s=>{const a=await s.table("datasets").toArray(),l=s.table("stats");for(const r of a)await l.get(r.id).catch(()=>{})||await l.put({datasetId:r.id,uniqueWordsSeen:0,updatedAt:Date.now()})}),this.version(4).stores({datasets:"id, name, languageTag, createdAt",decks:"id, datasetId, createdAt, [datasetId+createdAt]",imports:"id, datasetId, deckId, createdAt, [datasetId+deckId+createdAt]",sentences:"id, datasetId, deckId, order, importId, [datasetId+deckId], [datasetId+deckId+order], [datasetId+deckId+importId]",progress:"datasetId",pathProgress:"&[datasetId+deckId], datasetId, deckId, updatedAt",srs:"&[datasetId+deckId+sentenceId], datasetId, deckId, dueAt, [datasetId+deckId+dueAt]",seenWords:"&[datasetId+token], datasetId, firstSeenAt",stats:"datasetId, updatedAt"}).upgrade(async s=>{const a=await s.table("datasets").toArray(),l=await s.table("decks").toArray(),r=s.table("stats"),h=new Map;for(const i of a)h.set(i.id,!!i.cjkMode),await r.get(i.id).catch(()=>{})||await r.put({datasetId:i.id,uniqueWordsSeen:0,updatedAt:Date.now()});const o=s.table("sentences");await o.toCollection().modify(i=>{const p=h.get(i.datasetId)??!1,v=i.sourceText??i.english??i.source??i.en??i.front??i.prompt??"",j=i.targetText??i.target??i.answer??i.back??i.text??i.sentence??i.Target??"";(!i.sourceText||!String(i.sourceText).trim())&&typeof v=="string"&&v.trim()&&(i.sourceText=v),(!i.targetText||!String(i.targetText).trim())&&typeof j=="string"&&j.trim()&&(i.targetText=j),!i.transliterationText&&typeof i.transliteration=="string"&&(i.transliterationText=i.transliteration),!i.glossText&&typeof i.gloss=="string"&&(i.glossText=i.gloss),(typeof i.order!="number"||!Number.isFinite(i.order))&&(i.order=0);const b=String(i.targetText??"");(typeof i.tokenCount!="number"||!Number.isFinite(i.tokenCount)||i.tokenCount<=0)&&(i.tokenCount=Te(b,p))});const g=new Map;for(const i of l){const p=await o.where("[datasetId+deckId]").equals([i.datasetId,i.id]).toArray();p.sort((j,b)=>(j.order??0)-(b.order??0)||String(j.id).localeCompare(String(b.id)));let v=!1;p.forEach((j,b)=>{j.order!==b&&(j.order=b,v=!0)}),v&&p.length&&await o.bulkPut(p),g.set(`${i.datasetId}__${i.id}`,Math.max(0,p.length-1))}const k=s.table("pathProgress"),S=await k.toArray();let C=!1;for(const i of S){const p=`${i.datasetId}__${i.deckId}`,v=g.get(p);typeof v=="number"&&(typeof i.linearOrder=="number"&&i.linearOrder>v&&(i.linearOrder=v,C=!0),typeof i.srsNewOrder=="number"&&i.srsNewOrder>v&&(i.srsNewOrder=v,C=!0))}C&&await k.bulkPut(S)})}}const u=new _t;function oe(t){return`${t}_${crypto.randomUUID()}`}async function ht(t){const s={id:oe("ds"),name:t?.name?.trim()||"New language",languageTag:t?.languageTag?.trim()||"el-GR",rtlMode:"auto",tokenMode:"target",goalTokens:5e6,createdAt:Date.now(),theme:"paper",ttsRate:1,ttsPitch:1,cjkMode:!1};await u.datasets.add(s),await u.progress.put({datasetId:s.id,lifetimeReps:0,lifetimeTokens:0,currentIndex:0,updatedAt:Date.now()});const a=await Fe(s.id,"Main");return await He(s.id,a.id),await pe(s.id),s}async function Fe(t,s){const a={id:oe("deck"),datasetId:t,name:s.trim()||"Main",createdAt:Date.now()};return await u.decks.add(a),a}let ke=null,lt=new Map;async function Lt(){return ke||(ke=(async()=>{const t=await u.datasets.toCollection().first();return t||await ht({name:"Sample (Greek)",languageTag:"el-GR"})})(),ke)}async function ct(t){const s=lt.get(t);if(s)return s;const a=(async()=>{const l=await u.decks.where("datasetId").equals(t).sortBy("createdAt");if(l.length)return l[0];const r=await Fe(t,"Main");return await He(t,r.id),r})();return lt.set(t,a),a}async function He(t,s){const a=[t,s],l=await u.pathProgress.get(a);if(l)return l;const r={datasetId:t,deckId:s,mode:"linear",linearOrder:0,srsNewOrder:0,lifetimeReps:0,lifetimeTokens:0,updatedAt:Date.now()};return await u.pathProgress.put(r),r}async function pe(t){const s=await u.stats.get(t).catch(()=>{});if(s)return s;const a={datasetId:t,uniqueWordsSeen:0,updatedAt:Date.now()};return await u.stats.put(a),a}async function Ot(t,s){const a=Array.from(new Set(s.map(h=>h.trim()).filter(Boolean)));if(a.length===0)return 0;const l=a.map(h=>[t,h]),r=Date.now();return await u.transaction("rw",u.seenWords,u.stats,async()=>{const h=await u.seenWords.bulkGet(l),o=[];for(let S=0;S<a.length;S++)h[S]||o.push({datasetId:t,token:a[S],firstSeenAt:r});const g=await u.stats.get(t).catch(()=>{}),k=g??{datasetId:t,uniqueWordsSeen:0,updatedAt:r};return o.length?(await u.seenWords.bulkPut(o),await u.stats.put({...k,uniqueWordsSeen:(k.uniqueWordsSeen??0)+o.length,updatedAt:r})):g||await u.stats.put(k),o.length})}const Ne="https://chatgpt.com/g/g-6958a771444881918c4c59c6b55f33ca-interlinear-studio";function Mt(t){const s=t.toLowerCase().split(".");return s.length>1?s[s.length-1]:""}function be(t){return t==="two"?"Two columns":t==="threeTranslit"?"Three columns (with transliteration)":t==="threeGloss"?"Three columns (with gloss)":"Four columns"}function Ie(t){return t==="two"?["English","Target"]:t==="threeTranslit"?["English","Target","Transliteration"]:t==="threeGloss"?["English","Target","Gloss"]:["English","Target","Transliteration","Gloss"]}function Wt(t){return`You are preparing a spreadsheet for Sentence Paths.

Return ONLY a table (TSV preferred) with headers:
${Ie(t).join(" | ")}

Rules:
- One sentence per row.
- Keep rows in the order you want to practice (easy → hard).
- You MAY name the Target column like: "Target Language (Greek)" — Sentence Paths auto-detects common variants.
- Gloss should be word-by-word (token-level), not a paragraph.
- No extra commentary before or after the table.`}function Bt(t,s){const a=Ie(t),l=h=>h.join(s),r=t==="two"?["My parents don't know where I am.","…"]:t==="threeTranslit"?["My parents don't know where I am.","…","…"]:t==="threeGloss"?["My parents don't know where I am.","…","my parents / do not / know / where / I am"]:["My parents don't know where I am.","…","…","my parents / do not / know / where / I am"];return l(a)+`
`+l(r)}function dt(t){return[Ie(t),t==="two"?["My parents don't know where I am.","…"]:t==="threeTranslit"?["My parents don't know where I am.","…","…"]:t==="threeGloss"?["My parents don't know where I am.","…","my parents / do not / know / where / I am"]:["My parents don't know where I am.","…","…","my parents / do not / know / where / I am"]]}function We(t,s){const a=URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.download=t,l.click(),setTimeout(()=>URL.revokeObjectURL(a),2e3)}function Kt(t,s){const[a,l]=c.useState(()=>{const r=localStorage.getItem(t);return r==="1"?!0:r==="0"?!1:s});return c.useEffect(()=>{localStorage.setItem(t,a?"1":"0")},[t,a]),[a,l]}function Ut(t){const[s,a]=c.useState(!1),[l,r]=c.useState(0),[h,o]=c.useState("append"),[g,k]=c.useState([]),[S,C]=c.useState(""),[i,p]=Kt("sentencepaths_show_import_tips",!1),[v,j]=c.useState("two"),[b,L]=c.useState("xlsx"),w=d=>t.onToast?t.onToast(d):alert(d);c.useEffect(()=>{t.forceShowTips&&p(!0)},[t.forceShowTips]);const F=c.useRef(null),f=t.fileInputRef??F,_=c.useMemo(()=>({sourceKey:"english",targetKey:"target",translitKey:"transliteration",glossKey:"gloss",tokenKey:"tokencount",idKey:"id"}),[]);async function N(d){a(!0),r(0),k([]),C("");try{const y=Mt(d.name);if(y==="csv"||y==="tsv"){const D=await d.text(),{importCSVorTSV:E}=await $(async()=>{const{importCSVorTSV:B}=await Promise.resolve().then(()=>Be);return{importCSVorTSV:B}},void 0);await E({dataset:t.dataset,deckId:t.deck.id,filename:d.name,text:D,delimiter:y==="tsv"?"	":",",mapping:_,mode:h,onProgress:B=>r(B)}),await t.onImported();return}if(y==="xlsx"){const D=await d.arrayBuffer(),{listSheetNames:E,importXLSX:B}=await $(async()=>{const{listSheetNames:z,importXLSX:R}=await Promise.resolve().then(()=>Be);return{listSheetNames:z,importXLSX:R}},void 0),U=await E(D);k(U);const H=U[0]??"";if(C(H),U.length===1&&H){await B({dataset:t.dataset,deckId:t.deck.id,filename:d.name,arrayBuffer:D,sheetName:H,mapping:_,mode:h,onProgress:z=>r(z)}),await t.onImported();return}f.current._sentencepaths_last_xlsx={name:d.name,ab:D};return}w("Unsupported file type. Please import .xlsx, .csv, or .tsv.")}catch(y){w(y?.message||String(y))}finally{a(!1),r(0),f.current&&(f.current.value="")}}async function O(){try{const d=f.current?._sentencepaths_last_xlsx;if(!d){w("Please choose an .xlsx file first.");return}if(!S){w("Please choose a sheet.");return}a(!0),r(0);const{importXLSX:y}=await $(async()=>{const{importXLSX:D}=await Promise.resolve().then(()=>Be);return{importXLSX:D}},void 0);await y({dataset:t.dataset,deckId:t.deck.id,filename:d.name,arrayBuffer:d.ab,sheetName:S,mapping:_,mode:h,onProgress:D=>r(D)}),await t.onImported(),k([]),C(""),f.current._sentencepaths_last_xlsx=void 0}catch(d){w(d?.message||String(d))}finally{a(!1),r(0)}}return e.jsxs("div",{className:"panel",style:{padding:16,marginTop:12},children:[e.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",gap:10,flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:800,fontSize:16},children:"Import"}),e.jsx("div",{style:{color:"var(--muted)",fontSize:13},children:"xlsx / csv / tsv • auto-detects columns"})]}),e.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn "+(h==="append"?"primary":""),onClick:()=>o("append"),disabled:s,title:"Append rows to the end of this path",children:"Append"}),e.jsx("button",{className:"btn "+(h==="replace"?"primary":""),onClick:()=>o("replace"),disabled:s,title:"Replace this path entirely",children:"Replace"}),e.jsx("a",{className:"btn",href:Ne,target:"_blank",rel:"noreferrer",title:"Open Interlinear Studio to generate or clean an import sheet",style:{textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center"},children:"Interlinear Studio"})]})]}),e.jsxs("div",{style:{marginTop:10,color:"var(--muted)",fontSize:13,lineHeight:1.5},children:["Want the fastest path? Generate a ready-to-import sheet with ",e.jsx("strong",{children:"Interlinear Studio"}),", then upload it here."]}),t.showPickers!==!1&&e.jsxs("div",{className:"row",style:{gap:10,flexWrap:"wrap",marginTop:12},children:[e.jsx("span",{className:"pill",children:"Language"}),e.jsx("span",{className:"pill strong",children:t.dataset.name}),e.jsx("span",{className:"pill",children:"Path"}),e.jsx("select",{className:"btn",value:t.deck.id,onChange:d=>t.onSelectDeck(d.target.value),style:{minWidth:240},disabled:s,children:t.decks.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))}),e.jsx("button",{className:"btn",onClick:t.onCreateDeck,disabled:s,title:"Create a new path inside this language",children:"New path"})]}),i&&e.jsxs("div",{className:"panel",style:{padding:12,marginTop:12,background:"rgba(255,255,255,0.45)"},children:[e.jsxs("div",{className:"row",style:{justifyContent:"space-between",gap:10,alignItems:"center"},children:[e.jsx("div",{style:{fontWeight:700},children:"Templates & AI"}),e.jsx("button",{className:"btn",onClick:()=>p(!1),title:"Hide this section",children:"Hide"})]}),e.jsxs("div",{style:{color:"var(--muted)",fontSize:14,marginTop:8,lineHeight:1.55},children:["Pick your column layout, then either download a tiny template or copy an AI prompt.",e.jsx("br",{}),"Minimum: ",e.jsx("strong",{children:"English"})," + ",e.jsx("strong",{children:"Target"}),". Optional: ",e.jsx("strong",{children:"Transliteration"})," and ",e.jsx("strong",{children:"Gloss"})," (word-by-word)."]}),e.jsxs("div",{className:"row",style:{gap:10,flexWrap:"wrap",marginTop:10,alignItems:"center"},children:[e.jsx("span",{className:"pill",children:"Columns"}),e.jsxs("select",{className:"btn",value:v,onChange:d=>j(d.target.value),disabled:s,style:{minWidth:260},title:"Choose the columns you plan to import",children:[e.jsx("option",{value:"two",children:be("two")}),e.jsx("option",{value:"threeTranslit",children:be("threeTranslit")}),e.jsx("option",{value:"threeGloss",children:be("threeGloss")}),e.jsx("option",{value:"four",children:be("four")})]})]}),e.jsxs("div",{className:"row",style:{gap:10,flexWrap:"wrap",marginTop:10,alignItems:"center"},children:[e.jsx("span",{className:"pill",children:"Format"}),e.jsxs("select",{className:"btn",value:b,onChange:d=>L(d.target.value),disabled:s,style:{minWidth:220},title:"TSV is safest (no commas). XLSX is Excel-friendly.",children:[e.jsx("option",{value:"tsv",children:"TSV (recommended)"}),e.jsx("option",{value:"csv",children:"CSV"}),e.jsx("option",{value:"xlsx",children:"XLSX (Excel)"})]}),e.jsx("span",{className:"pill",title:"Keep rows in the order you want to practice (easy → hard).",children:"Order preserved"})]}),e.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap",marginTop:10},children:[e.jsx("a",{className:"btn primary",href:Ne,target:"_blank",rel:"noreferrer",style:{textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center"},title:"Generate or clean an import sheet",children:"Open Interlinear Studio"}),e.jsx("button",{className:"btn",onClick:async()=>{try{await navigator.clipboard.writeText(Wt(v)),w("AI prompt copied.")}catch{w("Copy failed.")}},disabled:s,children:"Copy AI prompt"}),e.jsx("button",{className:"btn",onClick:async()=>{try{if(b==="xlsx"){const E=await $(()=>import("./vendor-7461c230.js").then(q=>q.x),[]),B=dt(v),U=E.utils.aoa_to_sheet(B),H=E.utils.book_new();E.utils.book_append_sheet(H,U,"Template");const z=E.write(H,{bookType:"xlsx",type:"array"}),R=new Blob([z],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});We(`sentencepaths-template-${v}.xlsx`,R),w("Template downloaded.");return}const y=Bt(v,b==="tsv"?"	":","),D=new Blob([y],{type:"text/plain"});We(`sentencepaths-template-${v}.${b}`,D),w("Template downloaded.")}catch(d){w(d?.message||"Template failed.")}},disabled:s,children:"Download template"})]}),e.jsxs("div",{style:{marginTop:10,padding:10,borderRadius:12,border:"1px solid var(--border)",background:"rgba(255,255,255,0.42)"},children:[e.jsx("div",{style:{fontSize:12,fontWeight:800,letterSpacing:.3,color:"var(--muted)",textTransform:"uppercase"},children:"Headers"}),e.jsx("div",{style:{marginTop:6,fontFamily:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace",fontSize:13},children:Ie(v).join("  |  ")})]})]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("input",{ref:f,type:"file",accept:".csv,.tsv,.xlsx",disabled:s,style:{display:"none"},onChange:d=>{const y=d.target.files?.[0];y&&N(y)}}),e.jsxs("button",{className:"dropzone",type:"button",disabled:s,onClick:()=>f.current?.click(),"aria-label":"Choose import file",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[e.jsx("div",{style:{fontWeight:800,fontSize:16},children:"Choose file"}),e.jsx("div",{style:{color:"var(--muted)",fontSize:13},children:"CSV / TSV / XLSX"})]}),e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[e.jsx("span",{className:"pill",children:h==="append"?"Append":"Replace"}),e.jsx("span",{className:"pill",children:"Path order preserved"})]})]})]}),g.length>0&&e.jsxs("div",{className:"panel",style:{padding:12,marginTop:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Choose a sheet"}),e.jsxs("div",{className:"row",style:{gap:10,flexWrap:"wrap"},children:[e.jsx("select",{className:"btn",value:S,onChange:d=>C(d.target.value),style:{minWidth:260},children:g.map(d=>e.jsx("option",{value:d,children:d},d))}),e.jsx("button",{className:"btn primary",onClick:O,disabled:s,children:"Import sheet"})]})]}),s&&e.jsxs("div",{style:{marginTop:12},children:[e.jsxs("div",{style:{color:"var(--muted)",fontSize:13,marginBottom:6},children:["Importing… ",Math.round(l*100),"%"]}),e.jsx("div",{className:"progressOuter",style:{width:"100%"},children:e.jsx("div",{className:"progressInner",style:{width:`${Math.round(l*100)}%`}})})]}),!i&&e.jsxs("div",{className:"row",style:{marginTop:10,gap:8,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",onClick:async()=>{try{const d=await $(()=>import("./vendor-7461c230.js").then(U=>U.x),[]),y=dt(v),D=d.utils.aoa_to_sheet(y),E=d.utils.book_new();d.utils.book_append_sheet(E,D,"Template");const B=d.write(E,{bookType:"xlsx",type:"array"});We(`sentencepaths-template-${v}.xlsx`,new Blob([B],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),w("Template downloaded.")}catch{w("Template failed.")}},children:"Download template"}),e.jsx("button",{className:"btn",onClick:()=>p(!0),children:"Templates & AI"})]})]})}function Ft(t){const{languages:s,currentLanguageId:a,onAddLanguage:l,onRenameLanguage:r,onDeleteLanguage:h}=t,[o,g]=c.useState(""),[k,S]=c.useState(""),[C,i]=c.useState(null),[p,v]=c.useState(""),[j,b]=c.useState(null),[L,w]=c.useState(""),F=()=>{o.trim()&&(l(o.trim(),k.trim()),g(""),S(""))},f=y=>{p.trim()&&(r(y,p.trim()),i(null),v(""))},_=y=>{L&&(h(y,L),b(null),w(""))},N=y=>{i(y.id),v(y.name)},O=y=>{const D=s.find(E=>E.id!==y.id);b(y.id),w(D?.id||"")},d=s.length>1;return e.jsxs("div",{className:"panel",style:{padding:16,marginTop:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:10},children:"Languages"}),e.jsx("div",{style:{marginBottom:16},children:s.map(y=>e.jsx("div",{className:"language-item",children:C===y.id?e.jsxs("div",{className:"row",style:{flex:1,gap:8},children:[e.jsx("input",{type:"text",className:"btn",value:p,onChange:D=>v(D.target.value),placeholder:"Language name",style:{flex:1},autoFocus:!0}),e.jsx("button",{className:"btn primary",onClick:()=>f(y.id),children:"Save"}),e.jsx("button",{className:"btn",onClick:()=>i(null),children:"Cancel"})]}):j===y.id?e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{color:"var(--muted)",fontSize:14,marginBottom:8},children:"Move sentences to:"}),e.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:[e.jsx("select",{className:"btn",value:L,onChange:D=>w(D.target.value),style:{flex:1,minWidth:150},children:s.filter(D=>D.id!==y.id).map(D=>e.jsx("option",{value:D.id,children:D.name},D.id))}),e.jsx("button",{className:"btn",style:{color:"#c00"},onClick:()=>_(y.id),children:"Delete"}),e.jsx("button",{className:"btn",onClick:()=>b(null),children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{style:{fontWeight:y.id===a?700:400},children:y.name}),y.languageTag&&y.languageTag!=="und"&&e.jsxs("span",{style:{color:"var(--muted)",fontSize:13,marginLeft:8},children:["(",y.languageTag,")"]}),y.id===a&&e.jsx("span",{className:"pill",style:{marginLeft:8,padding:"4px 8px",fontSize:11},children:"current"})]}),e.jsxs("div",{className:"row",style:{gap:6},children:[e.jsx("button",{className:"btn btn-small",onClick:()=>N(y),children:"Rename"}),d&&e.jsx("button",{className:"btn btn-small",onClick:()=>O(y),children:"Delete"})]})]})},y.id))}),e.jsxs("div",{style:{borderTop:"1px solid var(--border)",paddingTop:12},children:[e.jsx("div",{style:{color:"var(--muted)",fontSize:14,marginBottom:8},children:"Add new language"}),e.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:[e.jsx("input",{type:"text",className:"btn",value:o,onChange:y=>g(y.target.value),placeholder:"Name (e.g. Greek)",style:{flex:2,minWidth:120}}),e.jsx("input",{type:"text",className:"btn",value:k,onChange:y=>S(y.target.value),placeholder:"Tag (e.g. el-GR)",style:{flex:1,minWidth:80}}),e.jsx("button",{className:"btn primary",onClick:F,disabled:!o.trim(),children:"Add"})]})]})]})}function Ht(t){const s=t.dataset,a=(s.languageTag||"und").toLowerCase(),l=a==="und"?"":a.split("-")[0],r=l?t.voices.filter(o=>(o.lang||"").toLowerCase().startsWith(l)):t.voices,h=r.length?r:t.voices;return e.jsxs("div",{className:"panel",style:{padding:16,marginTop:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:10},children:"Settings"}),e.jsxs("div",{className:"row",children:[e.jsx("span",{className:"pill",children:"Theme"}),e.jsxs("select",{className:"btn",value:s.theme==="dark"?"dark":"paper",onChange:o=>t.onUpdate({theme:o.target.value}),children:[e.jsx("option",{value:"paper",children:"Light (glossy)"}),e.jsx("option",{value:"dark",children:"Dark"})]}),e.jsx("span",{className:"pill",children:"Direction"}),e.jsxs("select",{className:"btn",value:s.rtlMode,onChange:o=>t.onUpdate({rtlMode:o.target.value}),children:[e.jsx("option",{value:"auto",children:"Auto"}),e.jsx("option",{value:"ltr",children:"LTR"}),e.jsx("option",{value:"rtl",children:"RTL"})]})]}),e.jsxs("div",{style:{marginTop:8,color:"var(--muted)",fontSize:13,lineHeight:1.45},children:["TTS uses your browser’s built-in voices. Voices for ",e.jsx("strong",{children:s.languageTag||"und"}),": ",r.length,". If you see zero, install a system voice for that language or try another browser/device."]}),e.jsxs("div",{className:"row",style:{marginTop:10},children:[e.jsx("span",{className:"pill",children:"Rate"}),e.jsx("input",{type:"range",min:"0.6",max:"1.4",step:"0.05",value:s.ttsRate,onChange:o=>t.onUpdate({ttsRate:Number(o.target.value)}),style:{width:220}}),e.jsx("span",{className:"pill",children:"Pitch"}),e.jsx("input",{type:"range",min:"0.6",max:"1.4",step:"0.05",value:s.ttsPitch,onChange:o=>t.onUpdate({ttsPitch:Number(o.target.value)}),style:{width:220}})]}),e.jsxs("div",{className:"row",style:{marginTop:10},children:[e.jsx("span",{className:"pill",children:"Voice"}),e.jsxs("select",{className:"btn",value:s.preferredVoiceURI??"",onChange:o=>t.onUpdate({preferredVoiceURI:o.target.value||void 0}),style:{minWidth:320},children:[e.jsx("option",{value:"",children:"Auto"}),h.map(o=>e.jsxs("option",{value:o.voiceURI,children:[o.name," — ",o.lang]},o.voiceURI))]}),e.jsx("button",{className:"btn",type:"button",onClick:t.onTestVoice,disabled:!t.onTestVoice,title:"Play a short test",children:"Test"}),e.jsxs("label",{className:"row",style:{gap:8},children:[e.jsx("input",{type:"checkbox",checked:s.cjkMode,onChange:o=>t.onUpdate({cjkMode:o.target.checked})}),e.jsx("span",{style:{color:"var(--muted)",fontSize:14},children:"CJK token approximation"})]})]})]})}function qt(){return/iPad|iPhone|iPod/.test(navigator.userAgent)}function Gt(){return window.matchMedia("(display-mode: standalone)").matches||navigator.standalone===!0}function Vt(){const[t,s]=c.useState(null),[a,l]=c.useState(!1),r=c.useMemo(()=>qt(),[]),h=c.useMemo(()=>Gt(),[]);return c.useEffect(()=>{const o=g=>{g.preventDefault(),s(g),l(!0)};return window.addEventListener("beforeinstallprompt",o),()=>window.removeEventListener("beforeinstallprompt",o)},[]),h?null:e.jsxs("div",{className:"panel",style:{padding:16,marginTop:12},children:[e.jsxs("div",{className:"row",style:{justifyContent:"space-between"},children:[e.jsxs("div",{style:{maxWidth:700},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:4},children:"Install Sentence Paths"}),e.jsx("div",{style:{color:"var(--muted)",fontSize:14},children:"Works offline after the first load. Install it like an app for faster access."})]}),!r&&t&&e.jsx("button",{className:"btn primary",onClick:async()=>{try{await t.prompt(),l(!1)}catch{l(!1)}},children:"Install"})]}),r&&e.jsxs("div",{style:{marginTop:12,color:"var(--muted)",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"iOS Safari:"})," tap ",e.jsx("span",{className:"kbd",children:"Share"})," →"," ",e.jsx("span",{className:"kbd",children:"Add to Home Screen"}),"."]}),e.jsx("div",{style:{marginTop:6},children:"After installing, open from your home screen for the best experience."})]}),!r&&!t&&a===!1&&e.jsx("div",{style:{marginTop:12,color:"var(--muted)",fontSize:14},children:"If you do not see an install button, your browser may not support PWA install for this build."})]})}function zt(t){const{row:s}=t,a=t.rtl?"rtl":"ltr";return s?e.jsx("div",{className:"panel sentenceCard",style:{padding:18,marginTop:18},dir:a,children:e.jsxs("div",{className:"sentenceGrid",children:[t.showSource?e.jsx("div",{className:"sentenceCol",children:e.jsx("div",{className:"sentenceSource",style:{fontSize:`${16*t.fontScale}px`},children:s.sourceText||"—"})}):null,e.jsxs("div",{className:"sentenceCol",children:[e.jsx("div",{className:"sentenceTarget",style:{fontSize:`${26*t.fontScale}px`},children:s.targetText||"—"}),t.showTranslit?e.jsx("div",{className:"sentenceMeta",children:e.jsx("div",{className:"sentenceMetaText",children:s.transliterationText||"—"})}):null,t.showGloss?e.jsx("div",{className:"sentenceMeta",children:e.jsx("div",{className:"sentenceMetaText",style:{whiteSpace:"pre-wrap"},children:s.glossText||"—"})}):null]})]})}):e.jsxs("div",{className:"panel",style:{padding:18,marginTop:18},children:[e.jsx("div",{style:{fontWeight:900,fontSize:18,marginBottom:6},children:"No sentences yet"}),e.jsxs("div",{style:{color:"var(--muted)",lineHeight:1.5},children:["Import a spreadsheet with at least two columns: ",e.jsx("strong",{children:"English"})," and ",e.jsx("strong",{children:"Target"}),".",e.jsx("br",{}),"(Optional: Transliteration, Gloss.)"]})]})}function Se(t){const s=c.useRef(null);return c.useEffect(()=>{if(!t.open)return;const a=l=>{l.key==="Escape"&&t.onClose()};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[t.open,t.onClose]),t.open?e.jsx("div",{className:"modalOverlay",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"modalCard",ref:s,children:[e.jsxs("div",{className:"modalHeader",children:[e.jsx("div",{style:{fontWeight:900},children:t.title??""}),e.jsx("button",{className:"iconBtn",onClick:t.onClose,"aria-label":"Close",children:"✕"})]}),e.jsx("div",{className:"modalBody",children:t.children})]})}):null}function Xt(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}function $t(){const t=typeof window<"u"&&"speechSynthesis"in window&&typeof SpeechSynthesisUtterance<"u",s=Xt(),[a,l]=c.useState([]),[r,h]=c.useState(!s),o=c.useRef("");c.useEffect(()=>{if(!t)return;const p=()=>l(window.speechSynthesis.getVoices());return p(),window.speechSynthesis.onvoiceschanged=p,()=>{window.speechSynthesis.onvoiceschanged=null}},[t]);const g=c.useCallback(()=>{if(t)try{const p=new SpeechSynthesisUtterance(" ");p.volume=0,window.speechSynthesis.cancel(),window.speechSynthesis.speak(p),h(!0)}catch{h(!0)}},[t]),k=c.useCallback(p=>{if(!a.length)return;if(p.voiceURI){const j=a.find(b=>b.voiceURI===p.voiceURI);if(j)return j}return a.filter(j=>(j.lang||"").toLowerCase().startsWith(p.lang.toLowerCase()))[0]??a[0]},[a]),S=c.useCallback((p,v)=>{if(o.current=p,!t||!p.trim()||s&&!r)return;try{window.speechSynthesis.resume?.()}catch{}window.speechSynthesis.cancel();const j=new SpeechSynthesisUtterance(p);j.lang=v.lang,j.rate=v.rate,j.pitch=v.pitch;const b=k(v);b&&(j.voice=b),o.current===p&&window.speechSynthesis.speak(j)},[k,r,s,t]),C=c.useCallback((p,v)=>(o.current=p,new Promise(j=>{if(!t||!p.trim()||s&&!r)return j();try{window.speechSynthesis.resume?.()}catch{}window.speechSynthesis.cancel();const b=new SpeechSynthesisUtterance(p);b.lang=v.lang,b.rate=v.rate,b.pitch=v.pitch;const L=k(v);if(L&&(b.voice=L),o.current!==p)return j();const F=Math.max(6e3,Math.min(45e3,Math.ceil(p.length*160))),f=window.setTimeout(()=>j(),F);b.onend=()=>{window.clearTimeout(f),j()},b.onerror=()=>{window.clearTimeout(f),j()},window.speechSynthesis.speak(b)})),[k,r,s,t]),i=c.useCallback(()=>{if(t)try{window.speechSynthesis.cancel()}catch{}},[t]);return{voices:a,unlocked:r,supported:t,prime:g,speak:S,speakAsync:C,stop:i,isIOS:s}}function Jt(t={}){const{immediate:s=!1,onNeedRefresh:a,onOfflineReady:l,onRegistered:r,onRegisteredSW:h,onRegisterError:o}=t;let g,k;const S=async(i=!0)=>{await k};async function C(){if("serviceWorker"in navigator){if(g=await $(async()=>{const{Workbox:i}=await import("./vendor-7461c230.js").then(p=>p.w);return{Workbox:i}},[]).then(({Workbox:i})=>new i("/sw.js",{scope:"/",type:"classic"})).catch(i=>{o?.(i)}),!g)return;g.addEventListener("activated",i=>{(i.isUpdate||i.isExternal)&&window.location.reload()}),g.addEventListener("installed",i=>{i.isUpdate||l?.()}),g.register({immediate:s}).then(i=>{h?h("/sw.js",i):r?.(i)}).catch(i=>{o?.(i)})}}return k=C(),S}async function mt(){return await $(()=>import("./vendor-7461c230.js").then(t=>t.x),[])}function W(t){return t.trim().toLowerCase()}function Yt(t,s){const a=t.split(/\r?\n/).filter(o=>o.trim().length>0);if(a.length===0)return{headers:[],rows:[]};const r=a[0].split(s).map(o=>o.trim()).map(W),h=a.slice(1).map(o=>{const g=o.split(s),k={};return r.forEach((S,C)=>k[S]=(g[C]??"").trim()),k});return{headers:r,rows:h}}function X(t,s,a){const l=new Set(t.map(W)),r=W(s);if(l.has(r))return r;for(const h of a?.equalsAny??[]){const o=W(h);if(l.has(o))return o}for(const h of t){const o=W(h),g=a?.containsAny??[];if(g.length&&g.every(k=>o.includes(W(k))))return o}for(const h of t){const o=W(h),g=a?.containsAny??[];if(g.length&&g.some(k=>o.includes(W(k))))return o}}function qe(t,s){const a=t.map(W),l=X(a,s.sourceKey,{equalsAny:["english","en","source","source text","source sentence","prompt"],containsAny:["english"]})??W(s.sourceKey),r=X(a,s.targetKey,{equalsAny:["target","target text","target sentence","answer","response"],containsAny:["target"]})??W(s.targetKey),h=s.translitKey?X(a,s.translitKey,{equalsAny:["transliteration","translit","romanization","romaji","pinyin"],containsAny:["translit"]}):X(a,"transliteration",{equalsAny:["transliteration","translit","romanization","romaji","pinyin"],containsAny:["translit"]}),o=s.glossKey?X(a,s.glossKey,{equalsAny:["gloss","word-by-word gloss","word by word gloss","wbg"],containsAny:["gloss","word-by-word","word by word"]}):X(a,"gloss",{equalsAny:["gloss","word-by-word gloss","word by word gloss","wbg"],containsAny:["gloss","word-by-word","word by word"]}),g=s.tokenKey?X(a,s.tokenKey,{equalsAny:["tokencount","token count"],containsAny:["token"]}):X(a,"tokencount",{equalsAny:["tokencount","token count"],containsAny:["token"]}),k=s.idKey?X(a,s.idKey,{equalsAny:["id","uuid"],containsAny:["id"]}):X(a,"id",{equalsAny:["id","uuid"],containsAny:["id"]});return{sourceKey:l,targetKey:r,translitKey:h,glossKey:o,tokenKey:g,idKey:k}}function V(t,s){if(!s)return"";const a=W(s);return String(t[a]??t[s]??"").trim()}async function Ae(t,s){await u.sentences.where("[datasetId+deckId]").equals([t,s]).delete(),await u.srs.where("[datasetId+deckId+dueAt]").between([t,s,0],[t,s,Number.MAX_SAFE_INTEGER]).delete(),await u.imports.where("[datasetId+deckId+createdAt]").between([t,s,0],[t,s,Number.MAX_SAFE_INTEGER]).delete();const a=await u.pathProgress.get([t,s]).catch(()=>{});a&&await u.pathProgress.put({...a,linearOrder:0,srsNewOrder:0,updatedAt:Date.now()})}async function Qt(t,s){const a=await u.sentences.where("[datasetId+deckId]").equals([t,s]).toArray();a.sort((o,g)=>(o.order??0)-(g.order??0)||String(o.id).localeCompare(String(g.id)));let l=!1;a.forEach((o,g)=>{o.order!==g&&(o.order=g,l=!0)}),l&&a.length&&await u.sentences.bulkPut(a);const r=Math.max(0,a.length-1),h=await u.pathProgress.get([t,s]).catch(()=>{});if(h){const o={...h,linearOrder:a.length?Math.min(h.linearOrder??0,r):0,srsNewOrder:a.length?Math.min(h.srsNewOrder??0,r):0,updatedAt:Date.now()};await u.pathProgress.put(o)}}async function Ke(t){const{datasetId:s,deckId:a,importId:l}=t;return await u.transaction("rw",u.sentences,u.imports,u.srs,u.pathProgress,async()=>{const h=(await u.sentences.where("[datasetId+deckId+importId]").equals([s,a,l]).toArray()).map(o=>o.id);if(h.length){await u.sentences.bulkDelete(h);const o=h.map(g=>[s,a,g]);await u.srs.bulkDelete(o)}return await u.imports.delete(l),await Qt(s,a),{deleted:h.length}})}async function pt(t,s){const a=await u.sentences.where("[datasetId+deckId+order]").between([t,s,0],[t,s,Number.MAX_SAFE_INTEGER]).last();return a?(a.order??0)+1:0}async function Zt(t){const{dataset:s,deckId:a,filename:l,text:r,delimiter:h,mapping:o,mode:g,onProgress:k}=t,S=Yt(r,h),C=S.headers,i=qe(C,o),p=C.includes(W(i.sourceKey)),v=C.includes(W(i.targetKey));if(!p||!v)throw new Error(`Missing required columns. Found headers: ${C.join(", ")}.

Expected at least English + Target (or a header containing "target", like "Target Language (Greek)").`);const j=S.rows,b=1500;return await u.transaction("rw",u.sentences,u.imports,u.srs,u.pathProgress,async()=>{g==="replace"&&await Ae(s.id,a);const L=g==="replace"?0:await pt(s.id,a),w=oe("imp"),F=Date.now(),f=[];let _=0;for(let O=0;O<j.length;O++){const d=j[O],y=V(d,i.sourceKey),D=V(d,i.targetKey);if(!y&&!D)continue;const E=V(d,i.tokenKey),B=E?Math.max(0,Number(E)||0):Te(D,s.cjkMode),U=V(d,i.idKey),H=U||oe("s");f.push({id:H,datasetId:s.id,deckId:a,order:L+_,importId:w,sourceText:y,targetText:D,transliterationText:V(d,i.translitKey)||void 0,glossText:V(d,i.glossKey)||void 0,tokenCount:B}),_++,f.length>=b&&(await u.sentences.bulkPut(f),f.length=0,k?.(O/j.length),await Ue.waitFor(new Promise(z=>setTimeout(z,0))))}f.length&&await u.sentences.bulkPut(f);const N={id:w,datasetId:s.id,deckId:a,filename:l,createdAt:F,mode:g,startOrder:L,endOrder:Math.max(L-1,L+_-1),rowCount:_};return await u.imports.add(N),k?.(1),{imported:_,headers:C,resolved:i}})}async function es(t){const{dataset:s,deckId:a,filename:l,arrayBuffer:r,sheetName:h,mapping:o,mode:g,onProgress:k}=t,S=await mt(),C=S.read(r,{type:"array"}),i=C.Sheets[h];if(!i)throw new Error("Sheet not found.");const v=S.utils.sheet_to_json(i,{defval:""}).map(f=>{const _={};for(const[N,O]of Object.entries(f))_[W(N)]=O;return _}),j=Object.keys(v[0]??{}).map(W),b=qe(j,o),L=j.includes(W(b.sourceKey)),w=j.includes(W(b.targetKey));if(!L||!w)throw new Error(`Missing required columns in sheet "${h}". Found headers: ${j.join(", ")}.

Expected at least English + Target (or a header containing "target", like "Target Language (Greek)").`);const F=1500;return await u.transaction("rw",u.sentences,u.imports,u.srs,u.pathProgress,async()=>{g==="replace"&&await Ae(s.id,a);const f=g==="replace"?0:await pt(s.id,a),_=oe("imp"),N=Date.now(),O=[];let d=0;for(let D=0;D<v.length;D++){const E=v[D],B=V(E,b.sourceKey),U=V(E,b.targetKey);if(!B&&!U)continue;const H=V(E,b.tokenKey),z=H?Math.max(0,Number(H)||0):Te(U,s.cjkMode),R=V(E,b.idKey),q=R||oe("s");O.push({id:q,datasetId:s.id,deckId:a,order:f+d,importId:_,sourceText:B,targetText:U,transliterationText:V(E,b.translitKey)||void 0,glossText:V(E,b.glossKey)||void 0,tokenCount:z}),d++,O.length>=F&&(await u.sentences.bulkPut(O),O.length=0,k?.(D/Math.max(1,v.length)),await Ue.waitFor(new Promise(Ce=>setTimeout(Ce,0))))}O.length&&await u.sentences.bulkPut(O);const y={id:_,datasetId:s.id,deckId:a,filename:l,createdAt:N,mode:g,startOrder:f,endOrder:Math.max(f-1,f+d-1),rowCount:d};return await u.imports.add(y),k?.(1),{sheets:C.SheetNames,imported:d,headers:j,resolved:b}})}async function ts(t){return(await mt()).read(t,{type:"array"}).SheetNames}const Be=Object.freeze(Object.defineProperty({__proto__:null,clearPathData:Ae,deleteImportBatch:Ke,importCSVorTSV:Zt,importXLSX:es,inferMappingFromHeaders:qe,listSheetNames:ts},Symbol.toStringTag,{value:"Module"}));function se(t,s,a){return Math.max(s,Math.min(a,t))}function ss(t){return/[\u0590-\u05FF\u0600-\u06FF]/.test(t)}function ut(t){return new Promise(s=>setTimeout(s,t))}function ns(t,s){return s==="again"?{ease:se(t-.2,1.3,2.8),mult:0,minDays:0}:s==="hard"?{ease:se(t-.05,1.3,2.8),mult:1,minDays:1}:s==="good"?{ease:se(t+0,1.3,2.8),mult:1.8,minDays:1}:{ease:se(t+.1,1.3,2.8),mult:2.2,minDays:1}}function as(t,s){const a=ns(t.ease,s),l=s==="again"?0:t.reps+1;let r=0;return s==="again"?r=0:t.reps===0?r=Math.max(1,a.minDays):t.reps===1?r=Math.max(3,a.minDays):r=Math.max(Math.round(t.intervalDays*a.ease*a.mult),a.minDays),{reps:l,intervalDays:r,ease:a.ease}}function rs(t,s,a){const l=new Blob([s],{type:a}),r=URL.createObjectURL(l),h=document.createElement("a");h.href=r,h.download=t,document.body.appendChild(h),h.click(),h.remove(),setTimeout(()=>URL.revokeObjectURL(r),2500)}function is(){const t=$t(),[s,a]=c.useState(null),l=n=>{a({msg:n,ts:Date.now()}),setTimeout(()=>a(m=>m&&Date.now()-m.ts>1800?null:m),2e3)},[r,h]=c.useState("home"),o=c.useRef("home"),g=()=>{r!=="library"&&(o.current=r),h("library")},k=()=>{h(o.current||"home")},[S,C]=c.useState(!1),i=c.useRef(null);c.useEffect(()=>{try{const n=Jt({immediate:!0,onNeedRefresh(){C(!0)},onOfflineReady(){}});i.current=n}catch{}},[]);async function p(){try{if(i.current){await i.current(!0);return}}catch{}try{if("serviceWorker"in navigator){const n=await navigator.serviceWorker.getRegistrations();for(const m of n)await m.unregister()}}catch{}try{if("caches"in window){const n=await caches.keys();await Promise.all(n.map(m=>caches.delete(m)))}}catch{}location.reload()}const[v,j]=c.useState([]),[b,L]=c.useState([]),[w,F]=c.useState(""),[f,_]=c.useState(""),N=c.useMemo(()=>v.find(n=>n.id===w)??null,[v,w]),O=c.useMemo(()=>b.find(n=>n.id===f)??null,[b,f]),[d,y]=c.useState(null),[D,E]=c.useState(0),[B,U]=c.useState(0),[H,z]=c.useState(0),[R,q]=c.useState(null),[Ce,Z]=c.useState(null),[ge,Ge]=c.useState(()=>localStorage.getItem("sentencepaths_showSource")!=="0"),[le,Ve]=c.useState(()=>localStorage.getItem("sentencepaths_showTranslit")==="1"),[ce,ze]=c.useState(()=>localStorage.getItem("sentencepaths_showGloss")==="1"),[De,os]=c.useState(()=>{const n=localStorage.getItem("sentencepaths_fontScale");return n?se(parseFloat(n),.8,1.4):1}),[Re,fe]=c.useState(!1),[Pe,we]=c.useState(!1),[Ee,ye]=c.useState(!1),[Xe,gt]=c.useState(!1),[xe,ft]=c.useState([]),[wt,de]=c.useState(!1),[_e,ne]=c.useState(!1),[$e,Je]=c.useState(""),[Ye,Qe]=c.useState(""),[Ze,yt]=c.useState(!1),[G,Le]=c.useState(()=>localStorage.getItem("sentencepaths_autoRun")==="1"),[ve,ee]=c.useState(!1),[ae,et]=c.useState(localStorage.getItem("sentencepaths_autoAfter")==="delay"?"delay":"audio"),[ue,xt]=c.useState(()=>{const n=localStorage.getItem("sentencepaths_autoDelaySec");return n?se(parseFloat(n),0,10):.5}),[he,vt]=c.useState(()=>localStorage.getItem("sentencepaths_ttsEnglish")==="1");c.useEffect(()=>{localStorage.setItem("sentencepaths_showSource",ge?"1":"0")},[ge]),c.useEffect(()=>{localStorage.setItem("sentencepaths_showTranslit",le?"1":"0")},[le]),c.useEffect(()=>{localStorage.setItem("sentencepaths_showGloss",ce?"1":"0")},[ce]),c.useEffect(()=>{localStorage.setItem("sentencepaths_fontScale",String(De))},[De]),c.useEffect(()=>{localStorage.setItem("sentencepaths_autoRun",G?"1":"0")},[G]),c.useEffect(()=>{G||ee(!1)},[G]),c.useEffect(()=>{r!=="practice"&&ee(!1)},[r]),c.useEffect(()=>{localStorage.setItem("sentencepaths_autoAfter",ae)},[ae]),c.useEffect(()=>{localStorage.setItem("sentencepaths_autoDelaySec",String(ue))},[ue]),c.useEffect(()=>{localStorage.setItem("sentencepaths_ttsEnglish",he?"1":"0")},[he]);const jt=c.useMemo(()=>N?N.rtlMode==="rtl"?!0:N.rtlMode==="ltr"?!1:R?.targetText?ss(R.targetText):!1:!1,[N,R]);async function tt(){const n=await Lt(),m=await ct(n.id),{seedSampleIfEmpty:T}=await $(async()=>{const{seedSampleIfEmpty:te}=await import("./sample-5bcd804c.js");return{seedSampleIfEmpty:te}},__vite__mapDeps([0,1,2,3]));await T(n,m),await pe(n.id);const x=await u.datasets.orderBy("createdAt").toArray(),I=localStorage.getItem("sentencepaths_currentDataset")??n.id,A=x.find(te=>te.id===I)?.id??n.id,M=await u.decks.where("datasetId").equals(A).sortBy("createdAt"),P=localStorage.getItem("sentencepaths_currentDeck")??M[0]?.id??m.id,K=M.find(te=>te.id===P)?.id??M[0]?.id??m.id;j(x),L(M),F(A),_(K)}async function st(n,m){const T=await ht({name:n,languageTag:m||"und"}),x=await ct(T.id);await pe(T.id);const I=await u.datasets.orderBy("createdAt").toArray();j(I),F(T.id),_(x.id),o.current="home",g(),de(!0),l("Language added")}c.useEffect(()=>{tt().catch(n=>console.error(n))},[]),c.useEffect(()=>{const n=N?.theme==="dark"?"dark":"paper";document.documentElement.setAttribute("data-theme",n)},[N?.theme]),c.useEffect(()=>{w&&(async()=>{const n=await u.decks.where("datasetId").equals(w).sortBy("createdAt");L(n);const m=n[0]?.id??"";(!f||!n.some(T=>T.id===f))&&_(m),localStorage.setItem("sentencepaths_currentDataset",w)})().catch(n=>console.error(n))},[w]),c.useEffect(()=>{f&&localStorage.setItem("sentencepaths_currentDeck",f)},[f]);async function J(){if(!w||!f)return;const n=await u.pathProgress.get([w,f]);n&&y(n);const m=await pe(w);E(m.uniqueWordsSeen??0);const T=await u.sentences.where("[datasetId+deckId]").equals([w,f]).count();U(T);const x=Date.now(),I=await u.srs.where("[datasetId+deckId+dueAt]").between([w,f,0],[w,f,x],!0,!0).count();z(I);const A=await u.imports.where("[datasetId+deckId+createdAt]").between([w,f,0],[w,f,Number.MAX_SAFE_INTEGER]).toArray();A.sort((M,P)=>(P.createdAt??0)-(M.createdAt??0)),ft(A)}async function Q(){if(!w||!f)return;const n=await u.pathProgress.get([w,f])??null;if(!n){q(null),Z(null);return}if(n.mode==="linear"){const P=await u.sentences.where("[datasetId+deckId+order]").equals([w,f,n.linearOrder]).first()??null;if(P){q(P),Z(null);return}const K=u.sentences.where("[datasetId+deckId+order]").between([w,f,0],[w,f,Number.MAX_SAFE_INTEGER],!0,!0),te=await K.first()??null,Oe=await K.last()??null,Me=Oe&&n.linearOrder>(Oe.order??0)?Oe:te;if(Me){const it={...n,linearOrder:Me.order??0,updatedAt:Date.now()};await u.pathProgress.put(it),y(it),q(Me)}else q(null);Z(null);return}const m=Date.now(),T=await u.srs.where("[datasetId+deckId+dueAt]").between([w,f,0],[w,f,m],!0,!0).sortBy("dueAt")??[];if(T.length){const P=T[0],K=await u.sentences.get(P.sentenceId)??null;q(K),Z(P);return}const x=await u.sentences.where("[datasetId+deckId+order]").equals([w,f,n.srsNewOrder]).first()??null;if(!x){q(null),Z(null);return}const I=[w,f,x.id],A=await u.srs.get(I)??null,M=A??{datasetId:w,deckId:f,sentenceId:x.id,dueAt:m,reps:0,ease:2.2,intervalDays:0,lastReviewedAt:0,createdAt:m};A||await u.srs.put(M),q(x),Z(M)}c.useEffect(()=>{!w||!f||(J().catch(()=>null),Q().catch(()=>null))},[w,f]),c.useEffect(()=>{d&&(Q().catch(()=>null),J().catch(()=>null))},[d?.mode,d?.linearOrder,d?.srsNewOrder]);async function nt(n){if(!N)return n.tokenCount??0;const m=n,T=m.target??m.Target??m.answer??m.response,x=m.english??m.English??m.source??m.prompt,I=(n.targetText||T||"").trim(),A=(n.sourceText||x||"").trim(),M=Te(I,N.cjkMode);if(!(I&&n.targetText!==I||A&&n.sourceText!==A||typeof n.tokenCount!="number"||n.tokenCount!==M))return n.tokenCount??M;const K={...n,targetText:I,sourceText:A,tokenCount:M};return await u.sentences.put(K),R?.id===K.id&&q(K),K.tokenCount??M}async function at(n){if(!N)return;const m=n,T=(n.targetText||m.target||m.Target||"").toString(),x=Et(T,N.cjkMode);if(!x.length)return;if(await Ot(N.id,x)>0){const A=await pe(N.id);E(A.uniqueWordsSeen??0)}}async function re(n,m){if(!w||!f||!d)return;const T=R,x=m&&T?await nt(T):0,I=d.linearOrder,A=Math.max(0,I+n),M=await u.sentences.where("[datasetId+deckId+order]").equals([w,f,A]).first()??null;if(!M){l("End of path");return}const P={...d,linearOrder:A,srsNewOrder:Math.max(d.srsNewOrder,A),lifetimeReps:d.lifetimeReps+(m?1:0),lifetimeTokens:d.lifetimeTokens+(m?x:0),updatedAt:Date.now()};await u.pathProgress.put(P),y(P),q(M),Z(null),m&&T&&(await at(T),await J())}async function Y(n){if(!w||!f||!d||!R)return;const m=await nt(R),T=Date.now(),x=Ce;R.id;const I=x??{datasetId:w,deckId:f,sentenceId:R.id,dueAt:T,reps:0,ease:2.2,intervalDays:0,lastReviewedAt:0,createdAt:T},A=as({reps:I.reps,intervalDays:I.intervalDays,ease:I.ease},n),M=T+A.intervalDays*24*60*60*1e3,P={...I,reps:A.reps,intervalDays:A.intervalDays,ease:A.ease,dueAt:M,lastReviewedAt:T};await u.srs.put(P);const K={...d,lifetimeReps:d.lifetimeReps+1,lifetimeTokens:d.lifetimeTokens+m,srsNewOrder:x?d.srsNewOrder:d.srsNewOrder+1,updatedAt:T};await u.pathProgress.put(K),y(K),await at(R),await J(),await Q()}async function je(n){if(!w||!f||!d)return;const m={...d,mode:n,updatedAt:Date.now()};await u.pathProgress.put(m),y(m),n==="srs"&&Le(!1)}async function ie(){if(!N||!R)return;if(!t.supported){l("Text-to-speech isn't available in this browser");return}if(t.isIOS&&!t.unlocked){t.prime(),l("Tap again to play audio");return}const n=R.targetText||"",m=R.sourceText||"";he&&m.trim()&&await t.speakAsync(m,{lang:"en-US",rate:1,pitch:1}),await t.speakAsync(n,{lang:N.languageTag||"und",rate:N.ttsRate??1,pitch:N.ttsPitch??1,voiceURI:N.preferredVoiceURI})}c.useEffect(()=>{if(r!=="practice")return;const n=x=>{const I=x;if(!I)return!1;const A=(I.tagName||"").toLowerCase();return A==="input"||A==="textarea"||A==="select"||I.isContentEditable},m=()=>{ye(!1),fe(!1),we(!1),ne(!1)},T=x=>{if(x.repeat||n(x.target))return;const I=x.key,A=I.toLowerCase();if(Ee||Re||Pe||_e){I==="Escape"&&(x.preventDefault(),m());return}if(I==="?"){x.preventDefault(),ye(P=>!P);return}if(A==="h"){x.preventDefault(),fe(!0);return}if(A==="s"){x.preventDefault(),we(!0);return}if(A==="l"){x.preventDefault(),g();return}if(I==="Escape"){x.preventDefault(),h("home");return}if(d){if(A==="m"){x.preventDefault(),je(d.mode==="srs"?"linear":"srs");return}if(A==="p"){x.preventDefault(),ie();return}if(d.mode==="linear"){if(x.code==="Space"||I===" "){x.preventDefault(),G?ee(P=>!P):ie();return}if(A==="a"){x.preventDefault(),Le(P=>{const K=!P;return K&&ee(!1),K});return}if(A==="e"){x.preventDefault(),Ge(P=>!P);return}if(A==="t"){x.preventDefault(),Ve(P=>!P);return}if(A==="g"){x.preventDefault(),ze(P=>!P);return}if(A==="c"){x.preventDefault(),R?.targetText&&navigator.clipboard.writeText(R.targetText).then(()=>l("Copied"));return}if(I==="ArrowRight"){x.preventDefault(),G&&ee(!0),re(1,!0);return}if(I==="ArrowLeft"){x.preventDefault(),G&&ee(!0),re(-1,!0);return}return}if(d.mode==="srs"){if(I==="1"){x.preventDefault(),Y("again");return}if(I==="2"){x.preventDefault(),Y("hard");return}if(I==="3"){x.preventDefault(),Y("good");return}if(I==="4"){x.preventDefault(),Y("easy");return}}}};return window.addEventListener("keydown",T,{passive:!1}),()=>window.removeEventListener("keydown",T)},[r,Ee,Re,Pe,_e,d,G,R?.targetText,ie,re,je,Y]);const me=c.useRef(0);c.useEffect(()=>{if(!G||ve||r!=="practice"||!d||d.mode!=="linear"||!R)return;const n=++me.current;return(async()=>(await ut(120),me.current===n&&(await ie(),me.current===n&&(ae==="delay"&&await ut(ue*1e3),me.current===n&&await re(1,!0)))))(),()=>{me.current++}},[G,ve,r,d?.mode,R?.id,ae,ue]);const kt=d?.lifetimeReps??0,bt=d?.lifetimeTokens??0,rt=N?.name??"",St=!!R?.transliterationText?.trim(),Nt=!!R?.glossText?.trim(),Tt=d?.mode==="srs"?"Review":"Read";return e.jsxs("div",{className:"container",children:[e.jsxs("header",{className:"topbar",children:[e.jsxs("div",{className:"brandRow",children:[e.jsx("div",{className:"logoDot","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("div",{className:"brandTitle",children:"Sentence Paths"}),e.jsx("div",{className:"brandSub",children:"Bilingual sentences • local-first • TTS"})]})]}),e.jsxs("div",{className:"topbarCenter",children:[e.jsx("button",{className:"pill strong",onClick:g,title:"Library & import",children:rt?`${rt} · Library`:"Library & Import"}),e.jsx("span",{className:"pill",children:Tt})]}),e.jsxs("div",{className:"topbarRight",children:[e.jsxs("span",{className:"statChip",title:"Total repetitions",children:["Reps ",e.jsx("strong",{children:kt})]}),e.jsxs("span",{className:"statChip",title:"Total target tokens read",children:["Words read ",e.jsx("strong",{children:bt})]}),e.jsx("button",{className:"iconBtn",onClick:()=>fe(!0),title:"Help / setup",children:"?"}),e.jsx("button",{className:"iconBtn",onClick:()=>we(!0),title:"Settings",children:"⚙"})]})]}),S?e.jsxs("div",{className:"updateBanner",role:"status",children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("strong",{children:"Update available."})," Refresh to load the latest version (your local data stays intact)."]}),e.jsx("button",{className:"btn btn-small",onClick:()=>{p()},children:"Refresh"}),e.jsx("button",{className:"btn btn-small",onClick:()=>C(!1),"aria-label":"Dismiss",children:"Later"})]}):null,r==="home"?e.jsxs("div",{style:{marginTop:20},children:[e.jsxs("div",{className:"panel",style:{padding:20},children:[e.jsx("div",{style:{fontWeight:900,fontSize:22,letterSpacing:.2},children:"Start a session"}),e.jsx("div",{style:{color:"var(--muted)",marginTop:6,lineHeight:1.5},children:"Read sentences like a book, or review them with spaced repetition."}),e.jsxs("div",{className:"segmented",style:{marginTop:16},children:[e.jsx("button",{className:"segBtn "+(d?.mode!=="srs"?"active":""),onClick:()=>je("linear"),children:"Read"}),e.jsx("button",{className:"segBtn "+(d?.mode==="srs"?"active":""),onClick:()=>je("srs"),children:"Review"})]}),e.jsxs("div",{className:"row",style:{marginTop:18,gap:12,flexWrap:"wrap"},children:[B===0?e.jsx("button",{className:"btn primary heroBtn",onClick:()=>{de(!0),g()},children:"Add sentences"}):e.jsx("button",{className:"btn primary heroBtn",onClick:()=>h("practice"),children:"Start practice"}),e.jsx("button",{className:"btn",onClick:()=>ne(!0),children:"Add language"}),e.jsx("button",{className:"btn",onClick:()=>{de(!1),g()},children:"Library & Import"})]}),e.jsxs("div",{style:{marginTop:14,color:"var(--muted)",fontSize:13},children:["Current library: ",e.jsx("strong",{children:B})," sentences • Due: ",e.jsx("strong",{children:H})]})]}),e.jsx("div",{className:"panel",style:{padding:16,marginTop:12},children:e.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",gap:12,flexWrap:"wrap"},children:[e.jsxs("div",{style:{minWidth:240},children:[e.jsx("div",{style:{fontWeight:900,fontSize:16},children:"Interlinear Studio"}),e.jsx("div",{style:{color:"var(--muted)",fontSize:13,lineHeight:1.5,marginTop:6},children:"Generate or clean an import sheet (XLSX / CSV / TSV) in the exact format Sentence Paths expects."})]}),e.jsx("a",{className:"btn primary",href:Ne,target:"_blank",rel:"noreferrer",style:{textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center"},children:"Open Interlinear Studio"})]})})]}):null,r==="practice"?e.jsxs("div",{style:{marginTop:6},children:[e.jsx(zt,{row:R,showSource:ge,showTranslit:le,showGloss:ce,rtl:jt,fontScale:De,languageName:N?.name}),e.jsx("div",{className:"actionBar",style:{marginTop:14},children:d?.mode==="srs"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn",onClick:()=>h("home"),children:"Home"}),e.jsx("button",{className:"btn",onClick:ie,children:"Play"}),e.jsx("button",{className:"btn",onClick:()=>Y("again"),children:"Again"}),e.jsx("button",{className:"btn",onClick:()=>Y("hard"),children:"Hard"}),e.jsx("button",{className:"btn primary",onClick:()=>Y("good"),children:"Good"}),e.jsx("button",{className:"btn",onClick:()=>Y("easy"),children:"Easy"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn",onClick:()=>h("home"),children:"Home"}),e.jsx("button",{className:"btn",onClick:()=>re(-1,!0),children:"Prev"}),e.jsx("button",{className:"btn primary",onClick:ie,children:"Play"}),e.jsx("button",{className:"btn",onClick:()=>re(1,!0),children:"Next"}),e.jsx("button",{className:"btn "+(G?"primary":""),title:G?ve?"Auto mode is paused. Press Space to resume.":"Auto mode is on. Press Space to pause.":"Turn on auto mode",onClick:()=>{Le(n=>{const m=!n;return m&&ee(!1),m})},children:G&&ve?"Auto (paused)":"Auto"})]})}),e.jsxs("div",{className:"miniRow",style:{marginTop:12},children:[e.jsx("button",{className:"chip",onClick:()=>Ge(n=>!n),children:ge?"Hide English":"Show English"}),le||St?e.jsx("button",{className:"chip",onClick:()=>Ve(n=>!n),children:le?"Hide translit":"Show translit"}):null,ce||Nt?e.jsx("button",{className:"chip",onClick:()=>ze(n=>!n),children:ce?"Hide gloss":"Show gloss"}):null,e.jsx("button",{className:"chip",onClick:()=>{R?.targetText&&navigator.clipboard.writeText(R.targetText).then(()=>l("Copied"))},children:"Copy target"}),e.jsx("button",{className:"chip",onClick:()=>ye(!0),title:"Keyboard shortcuts ( ? )",children:"Shortcuts"})]})]}):null,r==="library"?e.jsxs("div",{style:{marginTop:18},children:[e.jsxs("div",{className:"panel",style:{padding:18},children:[e.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",gap:10},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:900,fontSize:18},children:"Library & Import"}),e.jsx("div",{style:{color:"var(--muted)",fontSize:13,marginTop:4},children:"Import sentences, add languages, and manage backups."})]}),e.jsxs("div",{className:"row",style:{gap:10,flexWrap:"wrap",justifyContent:"flex-end"},children:[e.jsx("button",{className:"btn",onClick:()=>ne(!0),children:"New language"}),e.jsx("button",{className:"btn",onClick:()=>{de(!1),k()},children:"Back"})]})]}),e.jsxs("div",{className:"row",style:{marginTop:12,gap:10,flexWrap:"wrap"},children:[e.jsxs("div",{style:{width:"100%"},children:[e.jsx("div",{className:"sectionLabel",children:"Step one — Choose language and path"}),e.jsx("div",{className:"sectionHint",children:"Imports go into the selected path."})]}),e.jsx("select",{className:"btn",value:w,onChange:n=>F(n.target.value),style:{minWidth:220},children:v.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))}),e.jsx("select",{className:"btn",value:f,onChange:n=>_(n.target.value),style:{minWidth:220},children:b.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))}),e.jsx("button",{className:"btn",onClick:async()=>{if(!N)return;const n=prompt("New path name (for this language):","Main");if(!n)return;const m=await Fe(N.id,n);await He(N.id,m.id);const T=await u.decks.where("datasetId").equals(N.id).sortBy("createdAt");L(T),_(m.id)},children:"New path"})]}),N&&O?e.jsxs("div",{style:{marginTop:14},children:[e.jsx("div",{className:"sectionLabel",children:"Step two — Import sentences"}),e.jsx("div",{className:"sectionHint",children:"Upload a CSV / TSV / XLSX with at least English and Target."}),e.jsx(Ut,{dataset:N,deck:O,decks:b,onSelectDeck:_,onCreateDeck:()=>{},showPickers:!1,forceShowTips:wt,onImported:async()=>{await J(),await Q(),de(!1),l("Imported")},onToast:l})]}):null,w&&f?e.jsxs("div",{className:"panel",style:{padding:14,marginTop:12},children:[e.jsx("div",{className:"sectionLabel",children:"Step three — Manage imports (optional)"}),e.jsx("div",{className:"sectionHint",children:"Delete a past import from this path, or undo the most recent one. (Your data is local-first.)"}),e.jsxs("div",{className:"row",style:{marginTop:10,gap:10,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",disabled:xe.length===0,onClick:async()=>{const n=xe[0];!n||!confirm(`Undo last import: ${n.fileName||"Import"}?`)||(await Ke(w,f,n.id),await J(),await Q(),l("Last import removed"))},children:"Undo last import"}),e.jsx("button",{className:"btn",onClick:()=>gt(n=>!n),children:Xe?"Hide import list":"Show import list"}),e.jsx("button",{className:"btn",onClick:async()=>{confirm("Clear this entire path? (Keeps other paths and languages.)")&&(await Ae(w,f),await J(),await Q(),l("Path cleared"))},children:"Clear this path"})]}),Xe?e.jsx("div",{style:{marginTop:10},children:xe.length===0?e.jsx("div",{style:{color:"var(--muted)",fontSize:13},children:"No imports yet for this path."}):e.jsx("div",{className:"list",children:xe.slice(0,20).map(n=>e.jsxs("div",{className:"listRow",style:{alignItems:"center"},children:[e.jsxs("div",{style:{flex:1,minWidth:220},children:[e.jsx("div",{style:{fontWeight:800},children:n.fileName||"Import"}),e.jsxs("div",{style:{color:"var(--muted)",fontSize:12,marginTop:2},children:[n.rowCount," rows • ",new Date(n.createdAt).toLocaleString()]})]}),e.jsx("button",{className:"btn btn-small",onClick:async()=>{confirm(`Delete this import: ${n.fileName||"Import"}?`)&&(await Ke(w,f,n.id),await J(),await Q(),l("Import deleted"))},children:"Delete"})]},n.id))})}):null]}):null,e.jsxs("div",{className:"panel",style:{padding:14,marginTop:12},children:[e.jsx("div",{className:"sectionLabel",children:"Step four — Backup (recommended)"}),e.jsx("div",{className:"sectionHint",children:"Sentence Paths is local-first. Back up your library before switching devices or clearing browser data."}),e.jsxs("div",{className:"row",style:{marginTop:10,gap:10,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",onClick:async()=>{const{exportAllToJSON:n}=await $(async()=>{const{exportAllToJSON:T}=await import("./backup-33ad317f.js");return{exportAllToJSON:T}},__vite__mapDeps([4,1,2,3])),m=await n();rs("sentencepaths_backup.json",m,"application/json"),l("Backup downloaded")},children:"Download backup"}),e.jsx("button",{className:"btn",onClick:async()=>{const n=document.createElement("input");n.type="file",n.accept=".json,application/json",n.onchange=async()=>{const m=n.files?.[0];if(!m)return;const T=await m.text(),{importAllFromJSON:x}=await $(async()=>{const{importAllFromJSON:I}=await import("./backup-33ad317f.js");return{importAllFromJSON:I}},__vite__mapDeps([4,1,2,3]));await x(T),await tt(),await J(),await Q(),l("Restored")},n.click()},children:"Restore backup"})]})]})]}),e.jsx("div",{style:{marginTop:12},children:e.jsx("button",{className:"btn btn-small",onClick:()=>yt(n=>!n),children:Ze?"Hide advanced tools":"Advanced tools"})}),Ze?e.jsx(Ft,{languages:v,currentLanguageId:w,onAddLanguage:async(n,m)=>{await st(n,m)},onRenameLanguage:async(n,m)=>{const T=await u.datasets.get(n);if(!T)return;await u.datasets.put({...T,name:m});const x=await u.datasets.orderBy("createdAt").toArray();j(x),l("Renamed")},onDeleteLanguage:async(n,m)=>{if(n===m)return;const x=(await u.sentences.where("datasetId").equals(n).toArray()).map(A=>({...A,datasetId:m}));await u.transaction("rw",[u.sentences,u.datasets],async()=>{x.length&&await u.sentences.bulkPut(x),await u.datasets.delete(n)});const I=await u.datasets.orderBy("createdAt").toArray();j(I),w===n&&F(m),l("Deleted")}}):null]}):null,e.jsx(Se,{open:_e,title:"New language",onClose:()=>ne(!1),children:e.jsxs("div",{className:"helpStack",children:[e.jsxs("div",{style:{color:"var(--muted)",lineHeight:1.5},children:["Add a language, then import a sheet of sentences. Minimum columns: ",e.jsx("strong",{children:"English"})," and ",e.jsx("strong",{children:"Target"}),"."]}),e.jsxs("div",{className:"panel",style:{padding:14},children:[e.jsx("div",{style:{fontWeight:800,marginBottom:8},children:"Language name"}),e.jsx("input",{className:"btn",value:$e,onChange:n=>Je(n.target.value),placeholder:"e.g., French",style:{width:"100%"}}),e.jsx("div",{style:{fontWeight:800,marginTop:12,marginBottom:8},children:"Language tag (optional)"}),e.jsx("input",{className:"btn",value:Ye,onChange:n=>Qe(n.target.value),placeholder:"e.g., fr-FR",style:{width:"100%"}}),e.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:10,marginTop:14,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",onClick:()=>ne(!1),children:"Cancel"}),e.jsx("button",{className:"btn primary",onClick:async()=>{const n=$e.trim();if(!n){l("Please enter a language name");return}await st(n,Ye.trim()),Je(""),Qe(""),ne(!1)},children:"Create"})]})]}),e.jsxs("div",{className:"panel",style:{padding:14,marginTop:12},children:[e.jsx("div",{style:{fontWeight:900,marginBottom:6},children:"Troubleshooting"}),e.jsx("div",{style:{color:"var(--muted)",lineHeight:1.5},children:"If you see database errors (IndexedDB), resetting local data usually fixes it. Export a backup first if you need it."}),e.jsx("div",{style:{marginTop:10},children:e.jsx("button",{className:"btn",onClick:async()=>{if(confirm("Reset local data on this device? This deletes all languages and progress stored in the browser."))try{await u.delete(),localStorage.removeItem("sentencepaths_currentDataset"),localStorage.removeItem("sentencepaths_currentDeck"),location.reload()}catch(n){l(n?.message||"Reset failed.")}},children:"Reset local data"})})]})]})}),e.jsx(Se,{open:Re,title:"Help & setup",onClose:()=>fe(!1),children:e.jsxs("div",{className:"helpStack",children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:900,marginBottom:6},children:"The flow"}),e.jsxs("ol",{style:{margin:0,paddingLeft:18,color:"var(--muted)"},children:[e.jsxs("li",{children:["If a language is empty, press ",e.jsx("strong",{children:"Add sentences"}),"."]}),e.jsxs("li",{children:["Press ",e.jsx("strong",{children:"Start practice"}),"."]}),e.jsxs("li",{children:["Choose ",e.jsx("strong",{children:"Read"}),' for "book mode" or ',e.jsx("strong",{children:"Review"})," for spaced repetition."]}),e.jsxs("li",{children:["Use ",e.jsx("strong",{children:"Library"})," to add languages, import, and back up."]})]})]}),e.jsxs("div",{className:"panel",style:{padding:14},children:[e.jsx("div",{style:{fontWeight:900,marginBottom:6},children:"Generate your import sheet"}),e.jsxs("div",{style:{color:"var(--muted)",lineHeight:1.5},children:["Use ",e.jsx("strong",{children:"Interlinear Studio"})," to generate or clean a sheet in the exact two / three / four-column format Sentence Paths imports."]}),e.jsx("div",{style:{marginTop:10},children:e.jsx("a",{className:"btn primary",href:Ne,target:"_blank",rel:"noreferrer",style:{textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center"},children:"Open Interlinear Studio"})})]}),e.jsxs("div",{className:"panel",style:{padding:14},children:[e.jsx("div",{style:{fontWeight:900,marginBottom:6},children:"Backup reminder"}),e.jsxs("div",{style:{color:"var(--muted)",lineHeight:1.5},children:["Sentence Paths is local-first. Back up your library regularly: ",e.jsx("strong",{children:"Library → Backup"}),"."]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:900,marginBottom:6},children:"Install as an app"}),e.jsx(Vt,{})]})]})}),e.jsx(Se,{open:Ee,title:"Keyboard shortcuts",onClose:()=>ye(!1),children:e.jsxs("div",{className:"helpStack",children:[e.jsxs("div",{style:{color:"var(--muted)",lineHeight:1.5},children:["Tips: shortcuts work when you are not typing in a field. Press ",e.jsx("strong",{children:"Esc"})," to return Home, or close this window."]}),e.jsxs("div",{className:"panel",style:{padding:14},children:[e.jsx("div",{style:{fontWeight:900,marginBottom:8},children:"Global"}),e.jsxs("div",{className:"shortcutGrid",children:[e.jsx("div",{className:"k",children:"?"}),e.jsx("div",{children:"Toggle shortcuts"}),e.jsx("div",{className:"k",children:"H"}),e.jsx("div",{children:"Open help"}),e.jsx("div",{className:"k",children:"S"}),e.jsx("div",{children:"Open settings"}),e.jsx("div",{className:"k",children:"L"}),e.jsx("div",{children:"Open library & import"}),e.jsx("div",{className:"k",children:"Esc"}),e.jsx("div",{children:"Home"})]})]}),e.jsxs("div",{className:"panel",style:{padding:14},children:[e.jsx("div",{style:{fontWeight:900,marginBottom:8},children:"Practice (Read mode)"}),e.jsxs("div",{className:"shortcutGrid",children:[e.jsx("div",{className:"k",children:"Space"}),e.jsx("div",{children:"Play audio (or pause/resume auto)"}),e.jsx("div",{className:"k",children:"P"}),e.jsx("div",{children:"Play audio"}),e.jsx("div",{className:"k",children:"←"}),e.jsx("div",{children:"Previous sentence"}),e.jsx("div",{className:"k",children:"→"}),e.jsx("div",{children:"Next sentence"}),e.jsx("div",{className:"k",children:"A"}),e.jsx("div",{children:"Toggle auto mode"}),e.jsx("div",{className:"k",children:"E"}),e.jsx("div",{children:"Show/hide English"}),e.jsx("div",{className:"k",children:"T"}),e.jsx("div",{children:"Show/hide transliteration"}),e.jsx("div",{className:"k",children:"G"}),e.jsx("div",{children:"Show/hide gloss"}),e.jsx("div",{className:"k",children:"C"}),e.jsx("div",{children:"Copy target text"}),e.jsx("div",{className:"k",children:"M"}),e.jsx("div",{children:"Toggle Read / Review"})]})]}),e.jsxs("div",{className:"panel",style:{padding:14},children:[e.jsx("div",{style:{fontWeight:900,marginBottom:8},children:"Practice (Review mode)"}),e.jsxs("div",{className:"shortcutGrid",children:[e.jsx("div",{className:"k",children:"P"}),e.jsx("div",{children:"Play audio"}),e.jsx("div",{className:"k",children:"1"}),e.jsx("div",{children:"Again"}),e.jsx("div",{className:"k",children:"2"}),e.jsx("div",{children:"Hard"}),e.jsx("div",{className:"k",children:"3"}),e.jsx("div",{children:"Good"}),e.jsx("div",{className:"k",children:"4"}),e.jsx("div",{children:"Easy"}),e.jsx("div",{className:"k",children:"M"}),e.jsx("div",{children:"Toggle Read / Review"})]})]})]})}),e.jsxs(Se,{open:Pe,title:"Settings",onClose:()=>we(!1),children:[N?e.jsx(Ht,{dataset:N,onUpdate:async n=>{const m={...N,...n};await u.datasets.put(m);const T=await u.datasets.orderBy("createdAt").toArray();j(T),l("Saved")},voices:t.voices,onTestVoice:()=>{N&&(t.prime(),t.speak("Voice test.",{lang:N.languageTag||"und",rate:N.ttsRate??1,pitch:N.ttsPitch??1,voiceURI:N.preferredVoiceURI}))}}):null,t.isIOS&&!t.unlocked?e.jsxs("div",{className:"panel",style:{padding:14,marginTop:12},children:[e.jsx("div",{style:{fontWeight:900,marginBottom:6},children:"Unlock TTS on iOS"}),e.jsxs("div",{style:{color:"var(--muted)",lineHeight:1.5},children:["iOS requires a user tap before speech can play. Tap the button once, then use ",e.jsx("strong",{children:"Play"}),"."]}),e.jsx("div",{style:{marginTop:10},children:e.jsx("button",{className:"btn primary",onClick:()=>{t.prime(),l("TTS unlocked")},children:"Unlock"})})]}):null,e.jsxs("div",{className:"panel",style:{padding:14,marginTop:12},children:[e.jsx("div",{style:{fontWeight:900,marginBottom:10},children:"Auto settings"}),e.jsxs("div",{className:"row",style:{gap:10,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn "+(he?"primary":""),onClick:()=>vt(n=>!n),children:he?"English TTS: on":"English TTS: off"}),e.jsx("button",{className:"btn "+(ae==="audio"?"primary":""),onClick:()=>et("audio"),children:"Auto after audio"}),e.jsx("button",{className:"btn "+(ae==="delay"?"primary":""),onClick:()=>et("delay"),children:"Auto after delay"}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("span",{style:{color:"var(--muted)",fontSize:13},children:"Delay"}),e.jsx("input",{className:"btn",type:"number",step:.5,min:0,max:10,value:ue,onChange:n=>xt(se(parseFloat(n.target.value||"0"),0,10)),style:{width:92}}),e.jsx("span",{style:{color:"var(--muted)",fontSize:13},children:"sec"})]})]})]}),e.jsxs("div",{className:"panel",style:{padding:14,marginTop:12},children:[e.jsx("div",{style:{fontWeight:900,marginBottom:6},children:"Troubleshooting"}),e.jsxs("div",{style:{color:"var(--muted)",lineHeight:1.5},children:["If the app looks stuck on an older version, use ",e.jsx("strong",{children:"Refresh app files"})," (keeps your local library). If you ever see a browser IndexedDB error (for example, ",e.jsx("strong",{children:'"transaction has finished"'}),"), a ",e.jsx("strong",{children:"Reset"})," usually fixes it."]}),e.jsxs("div",{className:"row",style:{marginTop:10,gap:10,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",onClick:()=>{p()},title:"Clears PWA caches and reloads (keeps your language data)",children:"Refresh app files (keep data)"}),e.jsx("button",{className:"btn",onClick:async()=>{if(confirm(`Reset local Sentence Paths data on this device?

This will delete your local library (languages, paths, progress).
Back up first if you need it.`)){try{await u.delete()}catch{}location.reload()}},title:"Deletes local IndexedDB data and reloads",children:"Reset local data"})]})]})]}),s?e.jsx("div",{className:"toast",children:s.msg}):null,e.jsx("footer",{style:{marginTop:30,color:"var(--muted)",fontSize:12,textAlign:"center"},children:D?e.jsxs("span",{children:["Unique target words seen: ",D]}):null})]})}It.createRoot(document.getElementById("root")).render(e.jsx(At.StrictMode,{children:e.jsx(is,{})}));export{Te as c,u as d,oe as m};
